<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Simple e.sveikata Fetch (no CSS)</title>
  </head>
  <body>
    <h1>Appointment Times — Specialist 1000107448</h1>
    <p>
      <button id="fetchBtn">Fetch</button>
      <button id="copyBtn">Copy URL</button>
    </p>
    <p id="status">Ready.</p>
    <div id="tableWrap"></div>
    <details>
      <summary>Raw JSON</summary>
      <pre id="raw" style="white-space: pre-wrap"></pre>
    </details>

    <script>
      const URL_TO_FETCH =
        "https://ipr.esveikata.lt/api/searches/appointments/times?municipalityId=6&organizationId=1000097423&specialistId=1000311919&page=0&size=50";

      const URL_TO_FETCH1 =
        "https://ipr.esveikata.lt/api/searches/appointments/times?municipalityId=6&organizationId=1000097423&specialistId=1000107448&page=0&size=50";

      const fetchBtn = document.getElementById("fetchBtn");
      const copyBtn = document.getElementById("copyBtn");
      const statusEl = document.getElementById("status");
      const rawEl = document.getElementById("raw");
      const tableWrap = document.getElementById("tableWrap");

      copyBtn.addEventListener("click", () => {
        navigator.clipboard
          .writeText(URL_TO_FETCH)
          .then(() => {
            statusEl.textContent = "Copied URL to clipboard.";
          })
          .catch(() => {
            statusEl.textContent = "Could not copy URL.";
          });
      });

      fetchBtn.addEventListener("click", run);
      window.addEventListener("load", run);

      async function run() {
        statusEl.textContent = "Fetching…";
        tableWrap.innerHTML = "";
        rawEl.textContent = "";
        try {
          const res = await fetch(URL_TO_FETCH, {
            headers: { Accept: "application/json" },
          });
          const text = await res.text();
          let data;
          try {
            data = JSON.parse(text);
          } catch {
            data = text;
          }
          rawEl.textContent =
            typeof data === "string" ? data : JSON.stringify(data, null, 2);
          if (!res.ok)
            throw new Error("HTTP " + res.status + " " + res.statusText);
          renderTable(data);
          statusEl.textContent = "Done.";
        } catch (err) {
          const msg = (err && err.message) || "Unknown error";
          const corsHint = msg.includes("Failed to fetch")
            ? " (Possible CORS block in browser.)"
            : "";
          statusEl.textContent = "Error: " + msg + corsHint;
        }
      }

      function renderTable(data) {
        let rows = [];
        if (Array.isArray(data)) {
          rows = data;
        } else if (data && typeof data === "object") {
          const possible =
            data.content ||
            data.items ||
            data.results ||
            data.data ||
            data.list;
          if (Array.isArray(possible)) rows = possible;
        }

        if (!rows.length) {
          if (data && typeof data === "object") {
            const t = document.createElement("table");
            const tbody = document.createElement("tbody");
            Object.entries(data).forEach(([k, v]) => {
              const tr = document.createElement("tr");
              const td1 = document.createElement("td");
              td1.textContent = k;
              tr.appendChild(td1);
              const td2 = document.createElement("td");
              td2.textContent = formatValue(v);
              tr.appendChild(td2);
              tbody.appendChild(tr);
            });
            t.appendChild(tbody);
            tableWrap.appendChild(t);
          } else {
            const p = document.createElement("p");
            p.textContent = "No tabular data to display.";
            tableWrap.appendChild(p);
          }
          return;
        }

        const cols = new Set();
        rows.forEach((r) => Object.keys(r || {}).forEach((k) => cols.add(k)));
        const headers = Array.from(cols);

        const table = document.createElement("table");
        const thead = document.createElement("thead");
        const trh = document.createElement("tr");
        headers.forEach((h) => {
          const th = document.createElement("th");
          th.textContent = h;
          trh.appendChild(th);
        });
        thead.appendChild(trh);
        table.appendChild(thead);

        const tbody = document.createElement("tbody");
        rows.forEach((r) => {
          const tr = document.createElement("tr");
          headers.forEach((h) => {
            const td = document.createElement("td");
            td.textContent = formatValue(r ? r[h] : undefined);
            tr.appendChild(td);
          });
          tbody.appendChild(tr);
        });
        table.appendChild(tbody);
        tableWrap.appendChild(table);
      }

      function formatValue(v) {
        if (v == null) return "";
        if (typeof v === "object") return JSON.stringify(v);
        const s = String(v);
        if (/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}/.test(s)) {
          try {
            return new Date(s).toLocaleString();
          } catch {
            return s;
          }
        }
        return s;
      }
    </script>

    <!-- Note: If you see a network error in the browser console, it might be due to CORS on this domain. 
       Run from a local web server or use a simple proxy if needed. -->
  </body>
</html>
